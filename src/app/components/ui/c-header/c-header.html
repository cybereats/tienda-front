<header class="c-header">
    <div class="c-header__container">
        <a href="/" class="c-header__logo">
            <span class="highlight">CYBER</span>EATS
        </a>

        <nav class="c-header__nav">
            <ul class="c-header__menu">
                <li class="c-header__item"><a routerLink="/" routerLinkActive="active"
                        [routerLinkActiveOptions]="{exact: true}" class="c-header__link">Inicio</a></li>
                <li class="c-header__item"><a routerLink="/computers" routerLinkActive="active"
                        class="c-header__link">Arsenal</a></li>
                <li class="c-header__item"><a routerLink="/food" routerLinkActive="active"
                        class="c-header__link">Comida</a></li>
            </ul>
        </nav>

        <div class="c-header__actions">

            @if (authService.user$ | async; as user) {
            <div class="c-header__orders-wrapper">
                <button class="c-header__orders orders-icon" (click)="toggleOrdersDropdown()">
                    <span class="c-header__orders-icon">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="4" y="2" width="12" height="2" fill="currentColor" />
                            <rect x="4" y="4" width="2" height="14" fill="currentColor" />
                            <rect x="14" y="4" width="2" height="14" fill="currentColor" />
                            <rect x="4" y="16" width="12" height="2" fill="currentColor" />
                            <rect x="7" y="6" width="6" height="2" fill="currentColor" />
                            <rect x="7" y="10" width="6" height="2" fill="currentColor" />
                            <rect x="7" y="14" width="4" height="2" fill="currentColor" />
                        </svg>
                    </span>
                    @if ((userOrderService.pendingCount$ | async); as count) {
                    <span class="c-header__orders-count">{{ count }}</span>
                    }
                </button>

                @if (showOrdersDropdown) {
                <div class="orders-dropdown" (mouseleave)="closeDropdown()">
                    <div class="orders-dropdown__header">
                        <h3>Mis Pedidos</h3>
                    </div>
                    <div class="orders-dropdown__content">
                        @if ((userOrderService.orders$ | async); as orders) {
                        @if (orders.length > 0) {
                        @for (order of orders; track order.id) {
                        <div class="order-item">
                            <div class="order-item__header">
                                <span class="order-item__id">#{{ order.id }}</span>
                                <span class="order-item__status"
                                    [class]="userOrderService.getStatusClass(order.status)">
                                    {{ userOrderService.getStatusLabel(order.status) }}
                                </span>
                            </div>
                            <div class="order-item__products">
                                @for (item of order.orderItems.slice(0, 2); track item.id) {
                                <span>{{ item.quantity }}x {{ item.product.label }}</span>
                                }
                                @if (order.orderItems.length > 2) {
                                <span class="more">+{{ order.orderItems.length - 2 }} más</span>
                                }
                            </div>
                            <div class="order-item__footer">
                                <span class="order-item__total">{{ userOrderService.getTotalPrice(order) |
                                    currency:'EUR':'symbol' }}</span>
                                <span class="order-item__date">{{ order.createdAt | date:'short' }}</span>
                            </div>
                        </div>
                        }
                        } @else {
                        <div class="orders-dropdown__empty">
                            <span class="empty-icon">[ERROR]</span>
                            <p>No tienes pedidos aún</p>
                        </div>
                        }
                        }
                    </div>
                </div>
                }
            </div>

            <a routerLink="/cart" class="c-header__cart cart-icon">
                <span class="c-header__cart-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Handle -->
                        <rect x="3" y="5" width="2" height="4" fill="currentColor" />
                        <!-- Top rim -->
                        <rect x="5" y="5" width="14" height="2" fill="currentColor" />
                        <!-- Right side -->
                        <rect x="19" y="7" width="2" height="8" fill="currentColor" />
                        <!-- Left side slant -->
                        <rect x="5" y="7" width="2" height="2" fill="currentColor" />
                        <rect x="6" y="9" width="2" height="2" fill="currentColor" />
                        <rect x="7" y="11" width="2" height="2" fill="currentColor" />
                        <rect x="8" y="13" width="2" height="2" fill="currentColor" />
                        <!-- Bottom -->
                        <rect x="10" y="15" width="9" height="2" fill="currentColor" />
                        <!-- Wheels -->
                        <rect x="9" y="18" width="3" height="3" fill="currentColor" />
                        <rect x="16" y="18" width="3" height="3" fill="currentColor" />
                    </svg>
                </span>
                @if ((cartService.cart$ | async)?.totalItems; as count) {
                <span class="c-header__cart-count">{{ count }}</span>
                }
            </a>
            <span class="c-header__username">{{ user.username }}</span>
            <button class="c-btn-text" (click)="logout()">Cerrar Sesión</button>
            } @else {
            <button class="c-btn-text" routerLink="/login">Iniciar Sesión</button>
            <button class="c-btn-glow" routerLink="/register">Unirse</button>
            }
        </div>
    </div>
</header>