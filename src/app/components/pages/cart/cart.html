<div class="cart-page">
  <div class="cart-page__container">
    <h1 class="cart-page__title">TU <span class="highlight">CARRITO</span></h1>

    @if ((cartService.cart$ | async); as cart) {
    @if (cart.items.length > 0) {
    <div class="cart-page__content">
      <div class="cart-page__items">
        @for (item of cart.items; track item.productId) {
        <div class="cart-item">
          <div class="cart-item__image">
            <img [src]="'assets/' + item.product?.image" [alt]="item.product?.label">
          </div>
          <div class="cart-item__info">
            <h3>{{ item.product?.label }}</h3>
            <span class="cart-item__price">{{ item.price | currency:'EUR':'symbol' }}</span>
          </div>
          <div class="cart-item__controls">
            <button class="qty-btn"
              (click)="updateQuantity($event, item.productId, item.quantity - 1, item.quantity)">‚àí</button>
            <span class="qty-value">{{ item.quantity }}</span>
            <button class="qty-btn"
              (click)="updateQuantity($event, item.productId, item.quantity + 1, item.quantity)">+</button>
          </div>
          <div class="cart-item__subtotal">
            {{ item.price * item.quantity | currency:'EUR':'symbol' }}
          </div>
          <button class="cart-item__remove" (click)="removeItem($event, item.productId)">‚úï</button>
        </div>
        }
      </div>

      <div class="cart-page__summary">
        <h2>Resumen del pedido</h2>
        <div class="summary-row">
          <span>Art√≠culos ({{ cart.totalItems }})</span>
          <span>{{ cart.totalPrice | currency:'EUR':'symbol' }}</span>
        </div>
        <div class="summary-row summary-row--total">
          <span>Total</span>
          <span>{{ cart.totalPrice | currency:'EUR':'symbol' }}</span>
        </div>

        <div class="delivery-options">
          <h3>Tipo de entrega</h3>
          <label class="delivery-option" [class.selected]="deliveryType === 'TABLE'">
            <input type="radio" name="deliveryType" value="TABLE" [(ngModel)]="deliveryType">
            <span class="delivery-option__icon">üçΩÔ∏è</span>
            <div class="delivery-option__info">
              <strong>En mesa</strong>
              <small>Requiere reserva activa</small>
            </div>
          </label>
          <label class="delivery-option" [class.selected]="deliveryType === 'PICKUP'">
            <input type="radio" name="deliveryType" value="PICKUP" [(ngModel)]="deliveryType">
            <span class="delivery-option__icon">üèÉ</span>
            <div class="delivery-option__info">
              <strong>Recogida en mostrador</strong>
              <small>Sin necesidad de reserva</small>
            </div>
          </label>
        </div>

        <button class="c-btn c-btn--glow c-btn--full" (click)="checkout()" [disabled]="isCheckingOut">
          @if (isCheckingOut) {
          <span class="loading-spinner"></span> PROCESANDO...
          } @else if (checkoutSuccess) {
          ‚úÖ ¬°PEDIDO REALIZADO!
          } @else {
          REALIZAR PEDIDO
          }
        </button>
      </div>
    </div>
    } @else {
    <div class="cart-page__empty">
      <span class="empty-icon">üõí</span>
      <h2>Tu carrito est√° vac√≠o</h2>
      <p>A√±ade algunos productos deliciosos</p>
      <a routerLink="/food" class="c-btn">VER MEN√ö</a>
    </div>
    }
    }
  </div>
</div>