<div class="arsenal">
    @if (isLoading) {
    <div class="loading-overlay">
        <div class="loader"></div>
        <p>CONECTANDO AL NÚCLEO...</p>
    </div>
    }

    <!-- Panel lateral de detalles -->
    <aside class="arsenal__sidebar">
        @if (selectedStation(); as station) {
        <div class="arsenal__details">
            <div class="details-header">
                <h2>{{ station.label }}</h2>
                <span class="badge {{ station.categoryPCResponse.slug }}">{{
                    getCategoryDisplayName(station.categoryPCResponse.slug) }}</span>
                <button class="close-btn" (click)="closeDetails()">×</button>
            </div>

            <div class="specs-grid">
                @let specs = getParsedSpecs(station.specs);
                <div class="spec">
                    <span class="label">CPU</span>
                    <span class="val">{{ specs.cpu }}</span>
                </div>
                <div class="spec">
                    <span class="label">GPU</span>
                    <span class="val">{{ specs.gpu }}</span>
                </div>
                <div class="spec">
                    <span class="label">RAM</span>
                    <span class="val">{{ specs.ram }}</span>
                </div>
            </div>

            <div class="station-meta">
                <p>Precio: <span class="highlight price-tag">{{ getCategoryPrice(station.categoryPCResponse.slug) |
                        currency:'EUR':'symbol' }}/hora</span></p>
                <p>En servicio: <span class="highlight">{{ station.workingSince }}</span></p>
                <p>Estado: <span class="highlight status-{{ station.status.toLowerCase() }}">{{ station.status ===
                        'AVAILABLE' ? 'Disponible' : station.status === 'OCCUPIED' ? 'Ocupado' : 'Mantenimiento'
                        }}</span></p>
            </div>

            @if (station.status === 'OCCUPIED') {
            <!-- <div class="session-info">
                <p>ESTADO: <span class="highlight">EN USO</span></p>
            </div> -->
            @if (isMyPc(station)) {
            <button class="c-btn c-btn--primary" (click)="openAdminPage(station)">ADMINISTRAR</button>
            } @else {
            <button class="c-btn c-btn--disabled" disabled>OCUPADO</button>
            }
            } @else if (station.status === 'MAINTENANCE') {
            <div class="maintenance-msg">EN REPARACIÓN</div>
            } @else {
            <a [routerLink]="['/reservar', station.slug]" class="c-btn c-btn--glow">RESERVAR AHORA</a>
            }
        </div>
        } @else {
        <div class="arsenal__empty-state">
            <div class="empty-icon"></div>
            <p>SELECCIONA UNA ESTACIÓN</p>
            <small>Haz clic en cualquier PC para ver sus especificaciones</small>
        </div>
        }

        <div class="arsenal__stats">
            <div class="stat-item">
                <span class="value">{{ stations.length }}</span>
                <span class="label">TOTAL</span>
            </div>
            <div class="stat-item available">
                <span class="value">{{ availableCount }}</span>
                <span class="label">LIBRES</span>
            </div>
            <div class="stat-item occupied">
                <span class="value">{{ occupiedCount }}</span>
                <span class="label">EN USO</span>
            </div>
        </div>

        <div class="arsenal__legend">
            <h3>LEYENDA</h3>
            <ul>
                <li class="status-available"><span class="dot"></span> Disponible</li>
                <li class="status-occupied"><span class="dot"></span> Ocupado</li>
                <li class="status-maintenance"><span class="dot"></span> Mantenimiento</li>
                <li class="status-mine"><span class="dot"></span> Mi Reserva</li>
            </ul>
        </div>
    </aside>

    <!-- Canvas de Konva -->
    <main class="arsenal__map">
        <div class="arsenal__map-hint">
            <small>Rueda: Zoom | Arrastrar: Mover mapa</small>
        </div>
        <div #konvaContainer class="konva-container"></div>
    </main>
</div>